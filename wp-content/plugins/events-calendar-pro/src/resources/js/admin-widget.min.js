!function(e,t){"use strict";var a={},i=e(document.body);a.search_id=function(e){var t=void 0;return"undefined"!=typeof e.id?t=e.id:"undefined"!=typeof e.ID?t=e.ID:"undefined"!=typeof e.value&&(t=e.value),void 0===e?void 0:t},a.calendar_toggle=function(e){e.find(".calendar-widget-filters-title").hide(),e.find(".calendar-widget-filters-operand").hide();var t=e.find(".calendar-widget-added-filters");if(t.length){var a=t.val()?jQuery.parseJSON(t.val()):new Object,i=0;for(var r in a)i+=a[r].length;i>0&&(e.find(".calendar-widget-filters-title").show(),i>1&&e.find(".calendar-widget-filters-operand").show())}},a.select2=function(){var i=e(this),r={};if(i.hasClass("select2-container")&&i.select2("destroy"),e("body").hasClass("wp-customizer")&&(r.dropdownCssClass="tribe-customizer-select2"),i.is("select")||(r.id=a.search_id),r.allowClear=!0,i.is("[data-prevent-clear]")&&(r.allowClear=!1),i.is("[data-options]")&&(r.data=i.data("options")),i.is("[data-hide-search]")&&(r.minimumResultsForSearch=1/0),i.is("[multiple]")&&(r.multiple=!0,t.isArray(i.data("separator"))?r.tokenSeparators=i.data("separator"):r.tokenSeparators=[i.data("separator")],r.separator=i.data("separator"),r.regexSeparatorElements=["^("],r.regexSplitElements=["(?:"],e.each(r.tokenSeparators,function(e,t){r.regexSeparatorElements.push("[^"+t+"]+"),r.regexSplitElements.push("["+t+"]")}),r.regexSeparatorElements.push(")$"),r.regexSplitElements.push(")"),r.regexSeparatorString=r.regexSeparatorElements.join(""),r.regexSplitString=r.regexSplitElements.join(""),r.regexToken=new RegExp(r.regexSeparatorString,"ig"),r.regexSplit=new RegExp(r.regexSplitString,"ig")),r.matcher=function(e,a){var i=0==a.toUpperCase().indexOf(e.toUpperCase());if(!i&&"undefined"!=typeof r.tags){var n=t.where(r.tags,{text:a});if(r.tags.length>0&&t.isObject(n)){var d=obj.search_id(n[0]);i=0==d.toUpperCase().indexOf(e.toUpperCase())}}return i},i.is("[data-tags]")&&(r.tags=i.data("options"),r.initSelection=function(a,i){var n=[];e(a.val().split(r.regexSplit)).each(function(){var e={id:this,text:this};if(r.tags.length>0&&t.isObject(r.tags[0])){var a=t.where(r.tags,{value:this});a.length>0&&(e=a[0],e={id:e.value,text:e.text})}n.push(e)}),i(n)},r.createSearchChoice=function(e,t){if(e.match(r.regexToken))return{id:e,text:e}},0===r.tags.length&&(r.formatNoMatches=function(){return i.attr("placeholder")})),i.is("[data-source]")){var n=i.data("source");r.data={results:[]},r.escapeMarkup=function(e){return e},r.ajax={dataType:"json",type:"POST",url:window.ajaxurl,results:function(e){return e.data}},r.ajax.data=function(e,t){return{action:"tribe_widget_dropdown_"+n,disabled:i.data("disabled")}}}i.on("open",function(){e(".select2-drop").css("z-index",1e7)}).select2(r)},a.setup=function(t,i){if("undefined"==typeof i){var i,r=e(t.target);if(!r.parents(".widget-top").length||r.parents("#available-widgets").length)return;i=r.closest("div.widget")}"object"==typeof i&&(i=e(i)),"jQuery"!=typeof i&&i.is('[id*="tribe-"]')&&(i.is('[id*="__i__"]')||(i.find(".tribe-widget-select2").each(a.select2).trigger("change"),i.on("change",".js-tribe-condition",function(){var t=e(this),a=t.data("tribeConditionalField"),r=i.find(".js-tribe-conditional").filter('[data-tribe-conditional-field="'+a+'"]'),n=t.val();r.hide().each(function(){var t=e(this);t.hasClass("tribe-select2")&&t.prev(".select2-container").hide()}).filter('[data-tribe-conditional-value="'+n+'"]').show().each(function(){var t=e(this);t.hasClass("tribe-select2")&&t.hide().prev(".select2-container").show()})}),e("body").hasClass("wp-customizer")||(e.isNumeric(t)||"widget-updated"===t.type)&&i.find(".js-tribe-condition").trigger("change")))},e(document).ready(function(t){e("body").hasClass("wp-customizer")||e('.widget[id*="tribe-"]').each(a.setup)}).on({"widget-added widget-synced widget-updated":a.setup}).on("change",".calendar-widget-add-filter",function(t){var i=e(this),r=i.parents('.widget[id*="tribe-"]'),n=r.find(".calendar-widget-filters-container"),d=r.find(".calendar-widget-filter-list"),s=r.find(".calendar-widget-added-filters"),o=s.val()?e.parseJSON(s.val()):{},l=t.added,c=i.data("disabled")?i.data("disabled"):[];if("undefined"!=typeof l){if(o[l.taxonomy.name]||(o[l.taxonomy.name]=[]),-1!==e.inArray(l.id,o[l.taxonomy.name]))return void i.select2("val","",!1);n.show(),o[l.taxonomy.name].push(l.id),s.val(JSON.stringify(o));var p=e("<a/>").attr({"data-tax":l.taxonomy.name,"data-term":l.id,"class":"calendar-widget-remove-filter",href:"#"}).text("(remove)"),g=e("<span/>").append(p),f=e("<li/>").append("p").html(l.taxonomy.labels.name+": "+l.text).append(g);d.append(f),a.calendar_toggle(r),c.push(l.id),i.data("disabled",c),i.select2("val","",!1)}}).on("click",".calendar-widget-remove-filter",function(i){i.preventDefault();var r=e(this),n=r.parents('.widget[id*="tribe-"]'),d=n.find(".calendar-widget-add-filter").not(".select2-container"),s=(n.find(".calendar-widget-filters-container"),n.find(".calendar-widget-filter-list"),n.find(".calendar-widget-added-filters")),o=s.val()?e.parseJSON(s.val()):{},l=r.data("term"),c=r.data("tax"),p=d.data("disabled")?d.data("disabled"):[];o[c]&&(o[c]=t.without(o[c],l.toString())),s.val(JSON.stringify(o)),d.data("disabled",t.without(p,l.toString())),r.closest("li").remove(),n.find('input[name^="widget-tribe-"]').trigger("change"),a.calendar_toggle(n)}),i.on("click.widgets-toggle",a.setup)}(jQuery.noConflict(),_);